{% extends "base.html" %}

{% block content %}
    <h1>FreeShelf</h1>
    <p>Welcome to FreeShelf, a website developed by <em>Robots!</em>!</p>
    <h2>Dynamic content</h2>
    <p>The library has the following Free Books:</p>
    
    {% if books %}
        <ul>
        {% for book in books %}
        <img src="{{ book.image.url }}" width="240" alt="{{ book.title }}, {{ book.description }}">
            <li><a href="{{ book.url }}">{{ book }}</a> - {{ book.author }}
                {% if book.category.count %}
                    <p>Category:
                    {% for category in book.category.all %}
                        <a href="{{ category.get_absolute_url }}">{{ category.name }}</a></p>
                    {% endfor %}
                {% endif %}
                <p>{{ book.description }}</p>
                
                {% if request.user.is_authenticated %}
                <form action="{% url 'book_favorite' book_pk=book.pk %}" method="POST">
                    {% csrf_token %}
                    <button type="submit">
                        {% if book in request.user.favorite_books.all %}
                            Unfavorite
                        {% else %}
                            Favorite
                        {% endif %}
                        this book
                    </button>
                </form>
                {% endif %}

                <p>
                    {{ book.favorited_by.count }} {{ book.favorited_by.count|pluralize:"person has,people have" }} favorited this book.
                </p>

                    

                <p>Date added: {{ book.date_added }}</p></li>

        {% endfor %}
        </ul>
    {% else %}
        <p>There are no books on the shelf.</p>
    {% endif %}

{% endblock %}